{% extends "base.html" %}
{% block title %}Blog{% endblock %}

{% block content %}
  <h2>Blog Posts</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if posts %}
    {% for post in posts %}
      <article>
        <h3><a href="{{ url_for('view_post', post_id=post.id) }}">{{ post.title }}</a></h3>
        <p><small>By {{ post.author_username }} on {{ post.timestamp }}
          {% if post.last_edited %}
            (Edited: {{ post.last_edited }})
          {% endif %}
          | {{ post.likes }} like(s)
        </small></p>
        <p>{{ post.content[:200] }}... <a href="{{ url_for('view_post', post_id=post.id) }}">Read More</a>
        {% if session.logged_in and session.username == post.author_username %}
          <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-sm btn-outline-secondary" style="margin-left: 10px;">Edit</a>
        {% endif %}
        </p>
      </article>
      <hr>
    {% endfor %}
  {% else %}
    <p>No blog posts yet. <a href="{{ url_for('create_post') }}">Create one?</a></p>
  {% endif %}
{% endblock %}
