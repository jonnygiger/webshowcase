{% extends "base.html" %}

{% block title %}Edit Series: {{ series.title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Edit Series: {{ series.title }}</h2>

    {% include '_flash_messages.html' %}

    <form method="POST" action="{{ url_for('edit_series', series_id=series.id) }}">
        <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" name="title" value="{{ series.title }}" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="5">{{ series.description if series.description is not none else '' }}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">Save Series Details</button>
        <a href="{{ url_for('view_series', series_id=series.id) }}" class="btn btn-secondary">Cancel</a>
    </form>

    <hr class="my-4">

    {# Posts currently in the series #}
    <h4>Posts in this Series</h4>
    {% if posts_in_series and posts_in_series|length > 0 %}
        <ul class="list-group mb-3">
            {% for post in posts_in_series %} {# series.posts is already ordered #}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        #{{ loop.index }} <!-- Assuming series.posts is correctly ordered -->
                        <a href="{{ url_for('view_post', post_id=post.id) }}">{{ post.title }}</a>
                    </span>
                    <form method="POST" action="{{ url_for('remove_post_from_series', series_id=series.id, post_id=post.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No posts currently in this series.</p>
    {% endif %}

    <hr class="my-4">

    {# Available posts to add to the series #}
    <h4>Add Posts to this Series</h4>
    {% if available_posts and available_posts|length > 0 %}
        <ul class="list-group mb-3">
            {% for post in available_posts %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <a href="{{ url_for('view_post', post_id=post.id) }}">{{ post.title }}</a>
                    <form method="POST" action="{{ url_for('add_post_to_series', series_id=series.id, post_id=post.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-success btn-sm">Add to Series</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>You have no other posts available to add to this series.</p>
    {% endif %}

    <hr class="my-4">

    <form method="POST" action="{{ url_for('delete_series', series_id=series.id) }}" style="display: inline-block; margin-top: 20px;">
        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this series? This action cannot be undone.');">Delete Entire Series</button>
    </form>

</div>
{% endblock %}
